{#- 
Template: taxon-info.ldt.ttl
Description: Template to generate triples taxonomy-summary data resulting from analysis performed on sample; in context of EMOBON.
Input:
    - ./taxonomy-summary/LSU/DBH.merged_LSU.fasta.mseq.tsv
    (or is it ./taxonomy-summary/LSU/DBB.merged_LSU.fasta.mseq.tsv ?)
 
Variable:
    - uri_to_crate
    - enanumber
    - obs_id
    - env_package
    - source_mat_id
-#}
{%- import 'macros/refs.ttl' as refs %}

{%- if ctrl.isFirst %}
{%- include 'includes/prefixes.ttl' %}

@base <{{ uri_to_crate ~ '/taxonomy-summary-' ~ su_indicator ~ '/' ~ su_indicator ~ '-taxonomy-summary'}}> .

{{ refs.sample(obs_id, env_package, source_mat_id) }}
    rdfs:seeAlso {{ ("https://www.ebi.ac.uk/ena/browser/view/" ~ enanumber) | uri }} ;
.
{%- endif %}

<#{{_.taxid}}>
    a prod:TaxonomicAnnotation ; 
    prod:ofSample {{ refs.sample(obs_id, env_package, source_mat_id) }} ;
    {#- unsure if the other properties in file, 'SU_rRNA' and 'OTU ID', are relevant #}
    dct:identifier <https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id={{_.taxid}}> ; 
    prod:otuID {{_.OTU_ID | xsd("integer")}} ; 
    prod:rRNA {{_.SU_rRNA | xsd("double")}} ;

    {%- if su_indicator == 'LSU' %}
    prod:geneticMarker <http://purl.obolibrary.org/obo/GO_0015934> ;
    {%- endif %}
    {%- if su_indicator == 'SSU' %}
    prod:geneticMarker <http://purl.obolibrary.org/obo/GO_0015935> ;
    {%- endif %}

    dct:isPartOf <> ; 
.

{%- if _.taxid %}
<https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id={{_.taxid}}>
    a dct:Taxon, schema:Taxon ;
        {%- set taxonomy_array = _.taxonomy.split(';') %}
        {%- set taxon_item = taxonomy_array[-1] %}
        {%- set taxon_classification = taxonomy_array[:-1] %}
        {%- set taxon_rank_name = taxon_item.split('__') %}
        {%- set taxon_name = taxon_rank_name[-1] %}
        {%- set taxon_rank = taxon_rank_name[-2] %}
        {%- if taxon_name | length > 0 %}
        dct:title {{ taxon_name | xsd("string") }} ;
        dct:scientificName {{ taxon_name | xsd("string") }} ;
        {%- endif %}
        
        {%- if taxon_rank == 'sk' %}
        dct:taxonRank 'super kingdom'^^xsd:string ;
        {%- elif taxon_rank == 'k' %}
        dct:taxonRank 'kingdom'^^xsd:string ;
        {%- elif taxon_rank == 'p' %}
        dct:taxonRank 'phylum'^^xsd:string ;
        {%- elif taxon_rank == 'c' %}
        dct:taxonRank 'class'^^xsd:string ;
        {%- elif taxon_rank == 'o' %}
        dct:taxonRank 'order'^^xsd:string ;
        {%- elif taxon_rank == 'f' %}
        dct:taxonRank 'family'^^xsd:string ;
        {%- elif taxon_rank == 'g' %}
        dct:taxonRank 'genus'^^xsd:string ;
        {%- elif taxon_rank == 's' %}
        dct:taxonRank 'species'^^xsd:string ;
        {%- endif %}

        {%- if taxon_classification | length > 0 %}
        {%- set clean_classification = [] %}
            {%- for level in taxon_classification %}
                {%- set level_rank_name = level.split('__') %}
                {%- set level_name = level_rank_name[-1] %}
                {{ clean_classification.append(level_name) }}
            {%- endfor %}

        dwc:higherClassification {{ clean_classification.join(' | ') | xsd("string") }} ;
        {%- endif %}
.
{%- endif %}
