{#- 
Template: taxon-info.ldt.ttl.j2 
Description: Template to generate triples taxonomy-summary data resulting from analysis performed on sample; in context of EMOBON.
Input:
    - ./taxonomy-summary/LSU/DBH.merged_LSU.fasta.mseq.tsv
    (or is it ./taxonomy-summary/LSU/DBB.merged_LSU.fasta.mseq.tsv ?)
 
Variable:
    - cluster
    - genoscopeID
    - ENAnumber
    - obs_id
    - env_package
    - source_mat_id
-#}

{% if ctrl.isFirst %}
{% include './includes/prefixes.ttl' %}

@base <https://data.emobon.embrc.eu/analysis-results-{{cluster}}-crate/{{genoscopeID}}/taxonomy-summary> . 

<https://data.emobon.embrc.eu/observatory-{{obs_id}}-crate/{{env_package}}/sample/{{source_mat_id}}>
    schema:identifier {{ENAnumber | xsd("string")}}  , {{genoscopeID | xsd("string")}}  ;
    rdfs:seeAlso "https://www.ebi.ac.uk/ena/browser/view/{{ENAnumber}} ;
.
{%- endif %}

<>
    a _prod:TaxonomicAnnotation ; 
    _prod:ofSample <https://data.emobon.embrc.eu/observatory-{{obs_id}}-crate/{{env_package}}/sample/{{source_mat_id}}> ;
    {#- unsure if the other properties in file, 'LSU_rRNA' and 'OTU ID', are relevant #}
    dct:identifier <https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id={{_.taxid}}> ; 
    _prod:otuID {{_.OTU_ID | xsd("integer")}} ; 
    _prod:lsuRNA {{_.LSU_rRNA | xsd("double")}} ; 

    dct:isPartOf <> ; 
.

{%- if _.taxid %}
<https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id={{_.taxid}}>
    a dct:Taxon, schema:Taxon ;
        {%- set taxonomy_array = _.taxonomy.split(';') %}
        {%- set taxon_item = taxonomy_array[-1] %}
        {%- set taxon_rank_name = taxon_item.split('__') %}
        {%- set taxon_name = taxon_rank_name[-1] %}
        {%- set taxon_rank = taxon_rank_name[-2] %}
        {%- if taxon_name | length > 0 %}
        dct:title "{{ taxon_name | xsd("string") }}" ;
        dct:scientificName "{{ taxon_name | xsd("string") }}" ;
        {%- endif %}
        
        {%- if taxon_rank == 'sk' %}
        dct:taxonRank "super kingdom"^^xsd:string ;
        {%- elif taxon_rank == 'k' %}
        dct:taxonRank "kingdom"^^xsd:string ;
        {%- elif taxon_rank == 'p' %}
        dct:taxonRank "phylum"^^xsd:string ;
        {%- elif taxon_rank == 'c' %}
        dct:taxonRank "class"^^xsd:string ;
        {%- elif taxon_rank == 'o' %}
        dct:taxonRank "order"^^xsd:string ;
        {%- elif taxon_rank == 'f' %}
        dct:taxonRank "family"^^xsd:string ;
        {%- elif taxon_rank == 'g' %}
        dct:taxonRank "genus"^^xsd:string ;
        {%- elif taxon_rank == 's' %}
        dct:taxonRank "species"^^xsd:string ;
        {%- endif %}
.
{%- endif %}